import _toConsumableArray from"@babel/runtime/helpers/esm/toConsumableArray";import _slicedToArray from"@babel/runtime/helpers/esm/slicedToArray";import React,{useEffect}from"react";import{schemaValidator}from"./Utils/Validators";import{fieldTypes}from"./Fields";import{Button}from"@blueprintjs/core";import{createStore,combineReducers}from"redux";import{Provider}from"react-redux";import{Map}from"immutable";import formReducer from"./reducers/form";import validatorReducer from"./reducers/validator";import"normalize.css/normalize.css";import"@blueprintjs/icons/lib/css/blueprint-icons.css";import"@blueprintjs/core/lib/css/blueprint.css";import"@blueprintjs/datetime/lib/css/blueprint-datetime.css";import"./style.css";var store=createStore(combineReducers({form:formReducer,validator:validatorReducer}),window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__());function Form(a){var b=a.schema,c=b.onSubmit,d=b.set;useEffect(function(){d&&applyDispatchSchema(d),schemaValidator(b)},[b,d]);return React.createElement(Provider,{store:store},React.createElement("form",{onSubmit:function handleSubmit(a){a.preventDefault();var d=store.getState().form;applyValidators(b,d,store.dispatch)?c(d.toJS()):console.log("invalid")}},React.createElement(FormRows,{schema:b}),React.createElement("div",{className:"flex-right"},React.createElement(Button,{type:"submit",intent:"success",icon:"floppy-disk"},"Submit"))))}function FormRows(a){for(var b=a.schema,c=b.rows,d=Object.entries(b.fields),e=Array(c).fill([]),f=0;f<d.length;f++){var g=_slicedToArray(d[f],2),h=g[0],j=g[1],k=fieldTypes[j.type],l=j.row-1;e[l]=[].concat(_toConsumableArray(e[l]),[React.createElement(k,Object.assign({},j,{key:h,name:h}))])}return e.map(function(a,b){return React.createElement("div",{className:"row",key:b},a)})}function applyValidators(a,b,c){var d=Map(a.fields),e=d.reduce(function(a,c,d){if(c.validators){var e=c.validators.find(function(a){return!a.run(b.get(d),b)});if(e)return a.set(d,e.message)}return a},Map({}));return c({type:"SET_ERR_MAP",map:e}),0===e.size}function applyDispatchSchema(a){a(function(a){store.dispatch({type:"SET_FORM_STATE",data:a})})}export default Form;